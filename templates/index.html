<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <title>ML Demo – Iris Prediction</title>
    <style>
      body {
        font-family: sans-serif;
        max-width: 600px;
        margin: 40px auto;
      }
      label {
        display: block;
        margin-top: 10px;
      }
      input {
        width: 100%;
        padding: 6px;
      }
      button {
        margin-top: 15px;
        padding: 8px 12px;
      }
      #result {
        margin-top: 20px;
        font-weight: bold;
        white-space: pre-line;
      }
    </style>
  </head>
  <body>
    <h1>ML Demo – Iris Prediction</h1>
    <p>
      Gib die vier Iris-Features ein und klicke auf <strong>Predict</strong>.
    </p>

    <label
      >Sepal length (cm):
      <input id="f1" type="number" step="0.01" value="5.1" />
    </label>
    <label
      >Sepal width (cm):
      <input id="f2" type="number" step="0.01" value="3.5" />
    </label>
    <label
      >Petal length (cm):
      <input id="f3" type="number" step="0.01" value="1.4" />
    </label>
    <label
      >Petal width (cm):
      <input id="f4" type="number" step="0.01" value="0.2" />
    </label>

    <button onclick="sendPredict()">Predict</button>

    <div id="result"></div>

    <script>
      // Diese Funktion wird beim Klick auf den Button aufgerufen.
      async function sendPredict() {
        const f1 = parseFloat(document.getElementById("f1").value);
        const f2 = parseFloat(document.getElementById("f2").value);
        const f3 = parseFloat(document.getElementById("f3").value);
        const f4 = parseFloat(document.getElementById("f4").value);
        const payload = {
          features: [f1, f2, f3, f4],
        };

        const resDiv = document.getElementById("result");
        resDiv.textContent = "Bitte warten...";

        try {
          const response = await fetch("/predict", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          if (!response.ok) {
            const errText = await response.text();
            resDiv.textContent = "Fehler: " + errText;
            return;
          }

          const data = await response.json();

          // Schön formatiertes Ergebnis
          const cls = data.class_label;
          const pred = data.prediction;
          const probs = data.probabilities;

          let probText = "";
          if (probs && probs.length === 3) {
            probText =
              "Wahrscheinlichkeiten:" +
              "  setosa:     " +
              probs[0].toFixed(3) +
              "<br>" +
              "  versicolor: " +
              probs[1].toFixed(3) +
              "<br>" +
              "  virginica:  " +
              probs[2].toFixed(3);
          }

          resDiv.innerHTML =
            "Vorhergesagte Klasse: " +
            cls +
            " (Index: " +
            pred +
            ")<br>" +
            probText;
        } catch (err) {
          resDiv.innerHTML = "Fehler beim Request: " + err;
        }
      }
    </script>
  </body>
</html>
